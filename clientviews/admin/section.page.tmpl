{{template "admin-base" .}}

{{define "title"}}Section - vMaintain Admin{{end}}

{{define "admin-title"}}
    {{$s := index .RowSets "section"}}
    Section {{if gt $s.ID 0}}- {{$s.SectionName}} {{end}}
{{end}}
{{define "content-title"}}Section{{end}}
{{define "css"}}
{{end}}

{{define "content"}}

    {{$s := index .RowSets "section"}}

    <form method="post" action="/admin/sections/{{$s.ID}}" novalidate
          class="needs-validation"
          id="s-form">

        <input type="hidden" name="csrf_token" id="csrf_token" value="{{.CSRFToken}}">

        <div class="row">

            <div class="col-md-6 col-xs-12">
                <div class="form-group mt-3">
                    <label for="section_name">Section Name</label>
                    {{with .Form.Errors.Get "section_name"}}
                        <label class='text-danger'>{{.}}</label>
                    {{end}}
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text"><i class="fa fa-font fa-fw"></i></span>
                        </div>
                        <input class="form-control required {{with .Form.Errors.Get "section_name"}} is-invalid {{end}}"
                               id="section_name"
                               required
                               autocomplete="off" type='text'
                               name='section_name'
                               value='{{$s.SectionName}}'>
                        <div class="invalid-feedback">
                            Please enter a value
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="course_id">Course</label>
                    <select id="course_id" name="course_id" class="custom-select" required>
                        <option value="">Choose...</option>
                        {{$courses := index .RowSets "courses"}}
                        {{range $courses}}
                            <option value="{{.ID}}" {{if eq $s.CourseID .ID}} selected {{end}}>{{.CourseName}}</option>
                        {{end}}
                    </select>
                </div>

                <div class="form-group ">
                    <label for="active">Active</label>
                    <select id="active" name="active" class="custom-select">
                        <option value="0" {{if eq $s.Active 0}} selected {{end}}>No</option>
                        <option value="1" {{if eq $s.Active 1}} selected {{end}}>Yes</option>
                    </select>
                </div>

            </div>
        </div>

        <div class="row">
            <div class="col-md-6 col-xs-12">
                <hr>
                <input type="submit" class="btn btn-primary" value="Save">

                <a class="btn btn-info" href="/admin/sections/all">Cancel</a>

                {{if gt $s.ID 0}}
                    <div class="float-right">
                        <a class="btn btn-danger" href="#!" id="delete-section">Delete Section</a>
                    </div>
                    <div class="clearfix"></div>
                {{end}}
            </div>
        </div>
    </form>

{{end}}

{{define "js"}}
    <script>
        (function () {
            'use strict';
            window.addEventListener('load', function () {
                var forms = document.getElementsByClassName('needs-validation');
                var validation = Array.prototype.filter.call(forms, function (form) {
                    form.addEventListener('submit', function (event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();

        {{$s := index .RowSets "section"}}
        {{if gt $s.ID 0}}
        document.getElementById('delete-section').addEventListener('click', async function () {
            attention.confirm({
                html: "This delete the section, and all information associated with it (e.g. enrolled students). Are you sure?",
                showCancelButton: true,
                confirmButtonText: 'Delete Section',
                icon: 'warning',
                callback: function (result) {
                    if (result !== false) {
                        window.location.href = '/admin/sections/delete/{{$s.ID}}'
                    }
                }
            })
        });
        {{end}}
    </script>
{{end}}